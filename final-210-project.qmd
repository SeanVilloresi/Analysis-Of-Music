---
title: "Final 210 Project"
author: "Sean Villoresi and Ellie Kang"
format: pdf
---


## Read in the data

```{r read-data, message = F, warning = F}
library(tidyverse)
library(tidymodels)
library(broom)
library(leaps)
library(MASS)
library(caret)
library(glmnet)
library(Stat2Data)
library(nnet)
library(lme4)
music <- read_csv("data/Spotify_Youtube.csv")
```

##Cleaning the data

```{r cleaning, message = F, warning = F}
music$Uri=NULL
music$Url_youtube=NULL
music$Url_spotify=NULL

music <- music[complete.cases(music$Stream), ]
music <- music[complete.cases(music$Danceability), ]
music <- music[complete.cases(music$Licensed), ]
sum(is.na(music$Licensed))



```

## Variable Selection

```{r setup-for-variable-selection, message = F, warning = F}

indices <- sample(1:5000, size = 5000 * 0.8, replace = F)
train.data  <- music %>% 
  slice(indices)
test.data <- music %>% 
  slice(-indices)

lm_none <- lm(Stream ~ 1 , data = train.data)

lm_all <- lm(Stream ~ Danceability + Energy + Key + Loudness + Speechiness +
               Acousticness + Instrumentalness + Liveness +  Valence + Tempo + 
               Duration_ms + official_video + Licensed, data = train.data)

```


```{r stepwise-selection, message = F, warning = F}
stepAIC(lm_none, 
        scope = list(lower = lm_none, upper = lm_all),
        data = music, direction = "both")

```

```{r lasso, message = F, error = F}
y <- music$Stream
x <- model.matrix(Stream ~ Danceability + Energy + Key + Loudness + Speechiness +
               Acousticness + Instrumentalness + Liveness +  Valence + Tempo + 
               Duration_ms + official_video + Licensed,
                  data = music)

m_lasso_cv <- cv.glmnet(x, y, alpha = 1)
summary (m_lasso_cv)

best_lambda <- m_lasso_cv$lambda.min
m_best <- glmnet(x, y, alpha = 1, lambda = best_lambda)
m_best$beta 

```













